using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Microsoft.Xna.Framework;
using Microsoft.Xna.Framework.Graphics;
using Microsoft.Xna.Framework.Input;


namespace MO.SystemInvader
{
    public class Level
    {
        int[,] map = new int[,]
        {
            //00,01,02,03,04,05,06,07,08,09,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34
            {08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08},
            {08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08},
            {03,03,03,03,04,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08},//0
            {10,00,10,10,12,03,04,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08},//1
            {17,17,06,01,10,10,11,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08},//2
            {08,08,16,17,06,10,11,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08},//3
            {08,02,03,03,13,00,12,03,03,03,03,04,08,08,08,08,02,03,03,03,03,03,03,03,04,08,08,08,08,08,08,08,08,08,08},//4
            {08,09,10,00,10,00,10,10,10,00,10,11,08,08,08,08,09,10,10,00,10,00,00,01,11,08,08,08,08,08,08,08,08,08,08},//5
            {08,09,10,05,06,01,05,17,17,06,00,11,08,08,08,08,09,00,05,17,17,17,06,10,11,08,08,08,08,08,08,08,08,08,08},//6
            {08,09,00,12,13,10,11,08,08,09,01,12,03,03,03,03,13,10,11,08,08,08,09,10,11,08,08,08,08,08,08,08,08,08,08},//7
            {08,09,10,10,00,00,11,08,08,09,10,10,01,00,00,10,01,10,11,08,08,08,09,01,11,08,08,08,08,08,08,08,08,08,08},//8
            {08,16,17,17,17,17,18,08,08,16,17,17,17,17,17,17,17,17,18,08,08,08,09,00,11,08,08,08,08,08,08,08,08,08,08},//9
            {08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,02,03,03,03,03,13,00,12,03,03,03,03,03,03,03,04,08,08},//10
            {08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,08,09,00,10,01,00,10,00,01,10,00,10,00,01,10,10,11,08,08},//11
            {08,08,08,08,08,02,03,03,03,03,03,03,03,03,04,08,08,09,00,05,17,17,06,10,05,17,17,17,17,17,06,10,11,08,08},//12
            {08,08,08,08,02,13,10,10,10,00,00,01,10,00,11,08,08,09,10,19,20,08,09,01,11,08,08,08,08,08,09,00,11,08,08},//13
            {08,08,08,08,09,10,01,05,17,17,17,17,06,10,11,08,08,23,24,00,19,20,09,10,11,08,08,08,08,08,09,10,11,08,08},//14
            {08,08,08,08,09,10,05,18,08,08,08,08,09,00,11,08,08,08,23,24,10,19,13,00,11,08,08,08,08,08,09,01,11,08,08},//15
            {08,08,08,08,09,00,11,08,08,08,08,08,09,10,11,08,08,08,08,23,24,01,00,10,11,08,08,08,08,08,09,10,11,08,08},//16
            {08,08,08,08,09,00,11,08,08,08,08,08,09,01,11,08,08,08,08,08,23,17,17,17,18,08,08,08,08,08,09,10,11,08,08},//17
            {08,08,08,08,09,01,11,08,08,08,08,08,09,10,12,03,03,03,03,03,03,03,03,03,03,03,03,03,03,03,13,00,11,08,08},//18
            {08,08,08,08,09,10,11,08,08,08,08,08,09,00,00,10,01,10,00,00,10,01,00,00,10,00,01,10,10,10,10,01,11,08,08},//19
            {08,08,08,08,09,10,11,08,08,08,08,08,16,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,18,08,08},//20
        };

        public int Width => map.GetLength(1);
        public int Height => map.GetLength(0);

        public Texture2D _texture;

        public Vector2 AtTheEnd => new Vector2(5, 20) * 32;
        List<Texture2D> _listTexture;
        
        public int WindowWidth => Width * 32;
        public int WindowHeight => Height * 32;

        public Level()
        {
            _listTexture = new List<Texture2D>();
        }

        public bool IsInPaths(Vector2 vectorPos, Texture2D texture)
        {
            int x = 0;
            int y = 0;
            for (int i = 0; i < Width; i++)
            {
                y = 0;
                for (int j = 0; j < Height; j++)
                {
                    if (map[j, i] == 0 || map[j, i] == 1 || map[j, i] == 10)
                    {

                        float mapX1 = x;
                        float mapX2 = x + 32;
                        float mapY1 = y;
                        float mapY2 = y + 32;
                        float towerX1 = vectorPos.X;
                        float towerX2 = vectorPos.X + texture.Width;
                        float towerY1 = vectorPos.Y;
                        float towerY2 = vectorPos.Y + texture.Height;

                        if ((mapX1 > towerX1 && mapX1 < towerX2) || (mapX2 > towerX1 && mapX2 < towerX2) || (towerX1 > mapX1 && towerX1 < mapX2) || (towerX2 > mapX1 && towerX2 < mapX2))
                        {
                            if ((mapY1 > towerY1 && mapY1 < towerY2) || (mapY2 > towerY1 && mapY2 < towerY2) || (towerY1 > mapY1 && towerY1 < mapY2) || (towerY2 > mapY1 && towerY2 < mapY2))
                            {
                                return true;
                            }
                        }
                    }
                    y += 32;
                }
                x += 32;
            }
            return false;
        }

        public void AddTexture(List<Texture2D> listTexture)
        {
            _listTexture = listTexture;
        }


        //Draw/////////////////////////////////////////////////////////////////////////////////
        public void Draw(SpriteBatch batch)
        {
            for (int i = 0; i < Width; i++)
            {
                for (int j = 0; j < Height; j++)
                {
                    int _textureIndex = map[j, i];
                    _texture = _listTexture[_textureIndex];
                    batch.Draw(_texture, new Rectangle(i * 32, j * 32, 32, 32), Color.White);
                }
            }
        }
    }
}
